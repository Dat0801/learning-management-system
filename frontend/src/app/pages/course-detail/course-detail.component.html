<div class="course-detail-container" *ngIf="course; else loadingTpl">
  <!-- Hero Section -->
  <header class="course-header">
    <div class="header-content">
      <span class="badge" *ngIf="course.is_enrolled">Enrolled</span>
      <h1>{{ course.title }}</h1>
      <p class="description">{{ course.description }}</p>
      
      <div class="instructor-info" *ngIf="course.instructor">
        <div class="avatar-placeholder">{{ course.instructor.name.charAt(0) }}</div>
        <span>Created by <strong>{{ course.instructor.name }}</strong></span>
      </div>

      <div class="actions">
        <button *ngIf="!course.is_enrolled" class="btn-primary" (click)="enroll()">
          Enroll for ${{ course.price }}
        </button>
        <button *ngIf="course.is_enrolled" class="btn-secondary">
          Continue Learning
        </button>
        
        <button class="btn-wishlist" (click)="toggleWishlist()" [title]="isInWishlist ? 'Remove from wishlist' : 'Add to wishlist'">
          {{ isInWishlist ? '‚ô•' : '‚ô°' }}
        </button>
      </div>
    </div>
  </header>

  <div class="main-content">
    <!-- Video Preview Section -->
    <section class="video-preview">
      <h2>Course Preview</h2>
      <div class="video-placeholder">
        <div class="play-button">‚ñ∂</div>
        <p>Video Player Placeholder</p>
      </div>
    </section>

    <!-- Curriculum Section -->
    <section class="curriculum">
      <h2>Curriculum</h2>
      <div class="lesson-list">
        <div 
          class="lesson-item" 
          *ngFor="let lesson of course.lessons"
          [ngClass]="getLessonStatus(lesson)"
        >
          <div class="status-icon">
            <span *ngIf="getLessonStatus(lesson) === 'completed'">‚úì</span>
            <span *ngIf="getLessonStatus(lesson) === 'current'">‚ñ∂</span>
            <span *ngIf="getLessonStatus(lesson) === 'preview'">üëÅ</span>
            <span *ngIf="getLessonStatus(lesson) === 'locked'">üîí</span>
          </div>
          <div class="lesson-info">
            <h3>{{ lesson.title }}</h3>
            <!-- <p class="duration">10:00</p> -->
            <span *ngIf="lesson.is_preview && !course.is_enrolled" class="text-xs text-blue-500 ml-2">(Preview)</span>
          </div>
          <div class="lesson-action">
            <button 
              *ngIf="getLessonStatus(lesson) !== 'locked'" 
              class="btn-text"
              [routerLink]="['/learning', course.id]"
              [queryParams]="{lesson: lesson.id}"
            >
              {{ getLessonStatus(lesson) === 'completed' ? 'Review' : (getLessonStatus(lesson) === 'preview' ? 'Preview' : 'Start') }}
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Reviews Section -->
    <section class="reviews-section mt-8">
      <h2 class="text-2xl font-bold mb-4">Reviews & Ratings</h2>
      
      <!-- Reviews List -->
      <div class="reviews-list space-y-4">
        <div *ngIf="reviews.length === 0" class="text-gray-500">
          No reviews yet. Be the first to review!
        </div>

        <div *ngFor="let review of reviews" class="review-item bg-white p-4 rounded shadow-sm border">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-2">
              <div class="font-bold">{{ review.user?.name || 'User' }}</div>
              <div class="text-yellow-500">
                <span *ngFor="let i of [1,2,3,4,5]">
                  {{ i <= review.rating ? '‚òÖ' : '‚òÜ' }}
                </span>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <div class="text-sm text-gray-500">{{ review.created_at | date }}</div>
              <button 
                *ngIf="currentUser && currentUser.id === review.user_id"
                (click)="deleteReview(review.id)"
                class="text-red-500 hover:text-red-700 text-sm font-medium"
                title="Delete your review"
              >
                Delete
              </button>
            </div>
          </div>
          <p class="text-gray-700">{{ review.comment }}</p>
        </div>
      </div>

      <!-- Write Review Form -->
      <div *ngIf="course.is_enrolled && !userHasReviewed" class="write-review mt-8 p-6 bg-gray-50 rounded-lg border">
        <h3 class="text-xl font-semibold mb-4">Write a Review</h3>
        <form (ngSubmit)="submitReview()">
          <div class="mb-4">
            <label class="block mb-2 font-medium">Rating</label>
            <div class="flex gap-2">
              <button 
                type="button" 
                *ngFor="let i of [1,2,3,4,5]" 
                (click)="newReviewRating = i"
                class="text-2xl focus:outline-none"
                [class.text-yellow-500]="i <= newReviewRating"
                [class.text-gray-300]="i > newReviewRating"
              >
                ‚òÖ
              </button>
            </div>
          </div>
          <div class="mb-4">
            <label class="block mb-2 font-medium">Comment</label>
            <textarea 
              [(ngModel)]="newReviewComment" 
              name="comment"
              rows="3" 
              class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500"
              placeholder="Share your experience..."
            ></textarea>
          </div>
          <button 
            type="submit" 
            [disabled]="submittingReview"
            class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"
          >
            {{ submittingReview ? 'Submitting...' : 'Submit Review' }}
          </button>
        </form>
      </div>
    </section>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="loading">Loading course details...</div>
</ng-template>
