<div class="course-management-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="breadcrumbs">Admin <span class="separator">â€º</span> Course Management</div>
      <h1>Course Management</h1>
      <p class="subtitle">Monitor, edit, and organize your platform's curriculum.</p>
    </div>
    <div class="header-actions">
      <button class="btn-outline">
        <i class="fas fa-file-export"></i> Export CSV
      </button>
      <button class="btn-primary" (click)="openCreateCourseModal()">
        <i class="fas fa-plus"></i> Create New Course
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card" *ngFor="let stat of stats">
      <div class="stat-content">
        <div class="stat-header">
          <span class="stat-label">{{ stat.label }}</span>
          <div class="stat-icon" [ngClass]="stat.bg">
            <i [class]="stat.icon"></i>
          </div>
        </div>
        <div class="stat-body">
          <span class="stat-value">{{ stat.value }}</span>
          <div class="stat-trend" [ngClass]="stat.trend === 'up' ? 'up' : 'neutral'">
            <i class="fas" [ngClass]="stat.trend === 'up' ? 'fa-arrow-up' : 'fa-minus'"></i>
            <span class="trend-value">{{ stat.change }}</span>
            <span class="trend-text" *ngIf="stat.trend === 'up'">from last month</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Section -->
  <div class="content-section">
    <!-- Filters Bar -->
    <div class="filters-bar">
      <div class="search-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (keyup)="onSearch()" 
          placeholder="Search courses..."
          class="search-input"
        />
      </div>
      
      <div class="filter-actions">
        <!-- Category Filter -->
        <div class="dropdown-wrapper">
          <select [(ngModel)]="selectedCategory" (change)="onSearch()" class="filter-select">
            <option value="">All Categories</option>
            <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
          </select>
        </div>

        <!-- Status Filter -->
        <div class="dropdown-wrapper">
          <select [(ngModel)]="selectedStatus" (change)="onSearch()" class="filter-select">
            <option value="">All Status</option>
            <option value="draft">Draft</option>
            <option value="published">Published</option>
            <option value="archived">Archived</option>
          </select>
        </div>

        <button class="btn-filter" (click)="clearFilters()" title="Clear Filters">
          <i class="fas fa-filter-circle-xmark"></i>
        </button>
      </div>
    </div>

    <!-- Table -->
    <div class="table-responsive" *ngIf="courses$ | async as response">
      <table class="custom-table">
        <thead>
          <tr>
            <th class="col-checkbox">
              <input type="checkbox" />
            </th>
            <th>COURSE DETAILS</th>
            <th>CATEGORY</th>
            <th>INSTRUCTOR</th>
            <th>PRICE</th>
            <th>STATUS</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let course of paginatedCourses">
            <td class="col-checkbox">
              <input type="checkbox" />
            </td>
            <td>
              <div class="course-info-cell">
                <div class="course-thumbnail">
                  <img [src]="course.thumbnail || 'assets/images/course-placeholder.svg'" alt="Course Thumbnail">
                </div>
                <div class="course-details">
                  <span class="title">{{ course.title }}</span>
                  <span class="subtitle">ID: CRS-{{ course.id }}</span>
                </div>
              </div>
            </td>
            <td>
              <span class="category-badge">{{ course.category?.name || 'Uncategorized' }}</span>
            </td>
            <td>
              <div class="user-info">
                <img [src]="course.instructor?.avatar || 'assets/images/user-placeholder.svg'" alt="Instructor" class="avatar-circle-sm">
                <span class="name">{{ course.instructor?.name || 'Unknown' }}</span>
              </div>
            </td>
            <td>
              <span class="price-text">{{ course.price | currency }}</span>
            </td>
            <td>
              <span class="status-badge" [ngClass]="'status-' + (course.status || 'draft')">
                <i class="fas fa-circle status-dot"></i> {{ (course.status || 'draft') | titlecase }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-icon" (click)="editCourse(course)" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon delete" (click)="deleteCourse(course.id)" title="Delete">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="paginatedCourses.length === 0">
            <td colspan="7" class="text-center">No courses found.</td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination-bar">
        <div class="showing-text">
          Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ currentPage * itemsPerPage > totalItems ? totalItems : currentPage * itemsPerPage }} of {{ totalItems }} results
        </div>
        <div class="pagination-controls">
          <button class="page-btn prev" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngFor="let p of getPages(totalItems, itemsPerPage)" 
            class="page-btn" 
            [class.active]="p === currentPage"
            (click)="onPageChange(p)">
            {{ p }}
          </button>
          
          <button class="page-btn next" [disabled]="currentPage * itemsPerPage >= totalItems" (click)="onPageChange(currentPage + 1)">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" *ngIf="showEditForm">
    <div class="modal-content">
      <h2>{{ editingCourse.id ? 'Edit Course' : 'Create New Course' }}</h2>
      
      <form (ngSubmit)="saveCourse()">
        <div class="form-group">
          <label>Title</label>
          <input [(ngModel)]="editingCourse.title" name="title" class="form-control" placeholder="Course Title" required>
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea [(ngModel)]="editingCourse.description" name="description" rows="3" class="form-control" placeholder="Course Description"></textarea>
        </div>

        <div class="row">
          <div class="col">
            <div class="form-group">
              <label>Price</label>
              <input type="number" [(ngModel)]="editingCourse.price" name="price" class="form-control" placeholder="0.00" min="0">
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label>Status</label>
              <select [(ngModel)]="editingCourse.status" name="status" class="form-control">
                <option *ngFor="let status of statuses" [value]="status">{{ status | titlecase }}</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Category</label>
          <select [(ngModel)]="editingCourse.category_id" name="category_id" class="form-control">
             <option [ngValue]="null">Select Category</option>
             <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
          </select>
        </div>

        <!-- Curriculum Management -->
        <div class="curriculum-section">
           <h3>Curriculum</h3>
           <app-curriculum-management 
             [courseId]="editingCourse.id"
             [lessonsList]="editingCourse.lessons || []"
             (lessonsChange)="onLessonsChange($event)">
           </app-curriculum-management>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="cancelEdit()">Cancel</button>
          <button type="submit" class="btn-save">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>
