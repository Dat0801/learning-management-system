<div class="category-management-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="breadcrumbs">Admin <span class="separator">â€º</span> Category Management</div>
      <h1>Category Management</h1>
      <p class="subtitle">Manage course categories, subcategories, and structure.</p>
    </div>
    <div class="header-actions">
      <button class="btn-outline">
        <i class="fas fa-file-export"></i> Export CSV
      </button>
      <button class="btn-primary" (click)="openCreateModal()">
        <i class="fas fa-plus"></i> Add Category
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card" *ngFor="let stat of stats">
      <div class="stat-content">
        <div class="stat-header">
          <span class="stat-label">{{ stat.label }}</span>
          <div class="stat-icon" [ngClass]="stat.bg">
            <i [class]="stat.icon"></i>
          </div>
        </div>
        <div class="stat-body">
          <span class="stat-value">{{ stat.value }}</span>
          <div class="stat-trend" [ngClass]="stat.trend === 'up' ? 'up' : 'neutral'">
            <i class="fas" [ngClass]="stat.trend === 'up' ? 'fa-arrow-up' : 'fa-minus'"></i>
            <span class="trend-value">{{ stat.change }}</span>
            <span class="trend-text" *ngIf="stat.trend === 'up'">from last month</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Section -->
  <div class="content-section">
    <!-- Filters Bar -->
    <div class="filters-bar">
      <div class="search-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (keyup)="onSearch()" 
          placeholder="Search categories..."
          class="search-input"
        />
      </div>
      <div class="filter-actions">
        <button class="btn-filter">
          <i class="fas fa-filter"></i>
        </button>
      </div>
    </div>

    <!-- Table -->
    <div class="table-responsive">
      <table class="custom-table">
        <thead>
          <tr>
            <th class="col-checkbox">
              <input type="checkbox" />
            </th>
            <th>CATEGORY NAME</th>
            <th>SLUG</th>
            <th>DESCRIPTION</th>
            <th>COURSES</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let category of displayedCategories">
            <td class="col-checkbox">
              <input type="checkbox" />
            </td>
            <td>
              <div class="user-info">
                <div class="avatar-circle" [style.background-color]="'#e0e7ff'" [style.color]="'#4f46e5'">
                  {{ category.name.charAt(0) | uppercase }}
                </div>
                <div class="user-details">
                  <span class="name">{{ category.name }}</span>
                  <div class="sub-categories" *ngIf="category.children && category.children.length > 0">
                    <span *ngFor="let sub of category.children" class="badge-sm">{{ sub.name }}</span>
                  </div>
                </div>
              </div>
            </td>
            <td class="slug-col">{{ category.slug }}</td>
            <td class="desc-col" title="{{ category.description }}">{{ category.description | slice:0:50 }}{{ category.description?.length > 50 ? '...' : '' }}</td>
            <td>
              <span class="role-badge role-instructor">
                {{ category.courses_count || 0 }} Courses
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-icon" (click)="editCategory(category)" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon delete" (click)="deleteCategory(category.id)" title="Delete">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="displayedCategories.length === 0 && !isLoading">
            <td colspan="6" class="text-center">No categories found.</td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination-bar">
        <div class="showing-text">
          Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ currentPage * itemsPerPage > totalItems ? totalItems : currentPage * itemsPerPage }} of {{ totalItems }} results
        </div>
        <div class="pagination-controls">
          <button class="page-btn prev" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngFor="let p of getPages(totalItems, itemsPerPage)" 
            class="page-btn" 
            [class.active]="p === currentPage"
            (click)="onPageChange(p)">
            {{ p }}
          </button>
          
          <button class="page-btn next" [disabled]="currentPage * itemsPerPage >= totalItems" (click)="onPageChange(currentPage + 1)">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" *ngIf="showModal">
    <div class="modal-content">
      <h2>{{ editingCategory.id ? 'Edit Category' : 'New Category' }}</h2>
      
      <form>
        <div class="form-group">
          <label>Name</label>
          <input [(ngModel)]="editingCategory.name" name="name" (keyup)="generateSlug()" class="form-control" placeholder="Category Name">
        </div>

        <div class="form-group">
          <label>Slug</label>
          <input [(ngModel)]="editingCategory.slug" name="slug" class="form-control" placeholder="category-slug">
        </div>

        <div class="form-group">
          <label>Parent Category (Optional)</label>
          <select [(ngModel)]="editingCategory.parent_id" name="parent_id" class="form-control">
            <option [ngValue]="null">None</option>
            <option *ngFor="let cat of categories" [ngValue]="cat.id" [disabled]="cat.id === editingCategory.id">
              {{ cat.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea [(ngModel)]="editingCategory.description" name="description" rows="3" class="form-control"></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeModal()">Cancel</button>
          <button type="button" class="btn-save" (click)="saveCategory()">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
