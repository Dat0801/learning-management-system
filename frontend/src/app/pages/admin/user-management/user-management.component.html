<div class="user-management-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="breadcrumbs">Admin <span class="separator">â€º</span> User Management</div>
      <h1>User Management</h1>
      <p class="subtitle">Manage student and instructor accounts, roles, and platform access.</p>
    </div>
    <div class="header-actions">
      <button class="btn-outline">
        <i class="fas fa-file-export"></i> Export CSV
      </button>
      <button class="btn-primary" (click)="openCreateUserModal()">
        <i class="fas fa-user-plus"></i> Add New User
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card" *ngFor="let stat of stats">
      <div class="stat-content">
        <div class="stat-header">
          <span class="stat-label">{{ stat.label }}</span>
          <div class="stat-icon" [ngClass]="stat.bg">
            <i [class]="stat.icon"></i>
          </div>
        </div>
        <div class="stat-body">
          <span class="stat-value">{{ stat.value }}</span>
          <div class="stat-trend" [ngClass]="stat.trend">
            <i class="fas" [ngClass]="stat.trend === 'up' ? 'fa-arrow-up' : 'fa-arrow-down'"></i>
            <span class="trend-value">{{ stat.change }}</span>
            <span class="trend-text">from last month</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Section -->
  <div class="content-section">
    <!-- Filters Bar -->
    <div class="filters-bar">
      <div class="search-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (keyup)="onSearch()" 
          placeholder="Search by name, email, or ID..."
          class="search-input"
        />
      </div>
      <div class="filter-actions">
        <select [(ngModel)]="selectedRole" (change)="onSearch()" class="filter-select">
          <option value="">All Roles</option>
          <option *ngFor="let role of roles" [value]="role">{{ role | titlecase }}</option>
        </select>
        
        <select [(ngModel)]="selectedStatus" (change)="onSearch()" class="filter-select">
          <option value="">Status: All</option>
          <option value="Active">Active</option>
          <option value="Suspended">Suspended</option>
          <option value="Pending">Pending</option>
        </select>
        
        <button class="btn-filter">
          <i class="fas fa-filter"></i>
        </button>
      </div>
    </div>

    <!-- Table -->
    <div class="table-responsive" *ngIf="users$ | async as response">
      <table class="custom-table">
        <thead>
          <tr>
            <th class="col-checkbox">
              <input type="checkbox" />
            </th>
            <th>USER NAME</th>
            <th>EMAIL ADDRESS</th>
            <th>ROLE</th>
            <th>JOINED DATE</th>
            <th>STATUS</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of response.data">
            <td class="col-checkbox">
              <input type="checkbox" />
            </td>
            <td>
              <div class="user-info">
                <div class="avatar-circle" [style.background-color]="'#e0e7ff'" [style.color]="'#4f46e5'">
                  {{ user.name.charAt(0) | uppercase }}
                </div>
                <div class="user-details">
                  <span class="name">{{ user.name }}</span>
                  <span class="id">ID: {{ user.displayId }}</span>
                </div>
              </div>
            </td>
            <td class="email-col">{{ user.email }}</td>
            <td>
              <span class="role-badge" [ngClass]="'role-' + user.role">
                {{ user.role | uppercase }}
              </span>
            </td>
            <td class="date-col">{{ user.joinedDate | date:'MMM dd, yyyy' }}</td>
            <td>
              <div class="status-indicator" [ngClass]="user.status.toLowerCase()">
                <span class="dot"></span>
                {{ user.status }}
              </div>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-icon" (click)="editUser(user)" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon delete" (click)="deleteUser(user.id)" title="Delete">
                  <i class="fas fa-trash-alt"></i>
                </button>
                <button class="btn-icon enroll" (click)="openEnrollModal(user)" title="Enroll">
                  <i class="fas fa-graduation-cap"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination-bar">
        <div class="showing-text">
          Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ currentPage * itemsPerPage > totalItems ? totalItems : currentPage * itemsPerPage }} of {{ totalItems }} results
        </div>
        <div class="pagination-controls">
          <button class="page-btn prev" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngFor="let p of getPages(totalItems, itemsPerPage)" 
            class="page-btn" 
            [class.active]="p === currentPage"
            (click)="onPageChange(p)">
            {{ p }}
          </button>
          
          <button class="page-btn next" [disabled]="currentPage * itemsPerPage >= totalItems" (click)="onPageChange(currentPage + 1)">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div class="modal" *ngIf="showEditForm">
    <div class="modal-content">
      <h2>{{ editingUser.id ? 'Edit User' : 'Add New User' }}</h2>
      <form *ngIf="editingUser">
        <div class="form-group">
          <label>Name</label>
          <input type="text" [(ngModel)]="editingUser.name" name="name" required />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="editingUser.email" name="email" required />
        </div>
        <div class="form-group">
          <label>Role</label>
          <select [(ngModel)]="editingUser.role" name="role">
            <option *ngFor="let role of roles" [value]="role">{{ role | titlecase }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Password</label>
          <input 
            type="password" 
            [(ngModel)]="editingUser.password" 
            name="password" 
            [placeholder]="editingUser.id ? 'Leave blank to keep current' : 'Enter password'"
            [required]="!editingUser.id"
          />
        </div>
        <div class="form-actions">
          <button type="button" class="btn-save" (click)="saveUser()">Save User</button>
          <button type="button" class="btn-cancel" (click)="cancelEdit()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Enroll Modal -->
  <div class="modal" *ngIf="showEnrollModal">
    <div class="modal-content">
      <h2>Enroll User</h2>
      <div class="form-group" *ngIf="courses$ | async as courses">
        <label>Select Course to Enroll</label>
        <select [(ngModel)]="selectedCourseId" class="course-select">
          <option [ngValue]="null">-- Select a course --</option>
          <option *ngFor="let course of courses.data" [value]="course.id">{{ course.title }}</option>
        </select>
      </div>
      <div class="form-actions">
        <button class="btn-save" (click)="enrollUser()" [disabled]="!selectedCourseId">Enroll Now</button>
        <button class="btn-cancel" (click)="cancelEnroll()">Cancel</button>
      </div>
    </div>
  </div>
</div>
